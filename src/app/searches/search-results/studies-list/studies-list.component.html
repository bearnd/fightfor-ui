<div class="main-content">
  <div class="container-fluid">
    <div class="row">

      <div class="col-md-12">

        <div class="card">

          <!--Card header.-->
          <div class="card-header card-header-icon card-header-rose">
            <!--Header icon.-->
            <div class="card-icon">
              <i class="material-icons">local_pharmacy</i>
            </div>
            <!--Header title.-->
            <h4 class="card-title">
              {{ 'Trials' | uppercase }}
            </h4>
          </div>

          <!--Card body.-->
          <div class="card-body">

            <div class="col-md-12">

              <h5>Filters</h5>
              <div class="row">

                <form [formGroup]="formFilters" (ngSubmit)="onSubmitFilters()">
                  <div class="form-group">

                    <div class="row">

                      <div class="col-md-4">
                        <mat-form-field>
                          <mat-select
                            id="selectOverallStatus"
                            formControlName="selectOverallStatus"
                            placeholder="Overall Status"
                            [multiple]="true"
                            #selectOverallStatus
                          >
                            <ngx-mat-select-search
                              formControlName="filterOverallStatus"
                              placeholderLabel="Search"
                              noEntriesFoundLabel="No such overall-status found"
                            >
                            </ngx-mat-select-search>
                            <mat-option
                              *ngFor="let status of overallStatusesFiltered | async"
                              [value]="status"
                            >
                              {{ status.name }}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>

                      <div class="col-md-4">
                        <mat-form-field>
                          <mat-select
                            id="selectPhase"
                            formControlName="selectPhase"
                            placeholder="Trial Phase"
                            [multiple]="true"
                            #selectPhase
                          >
                            <ngx-mat-select-search
                              formControlName="filterPhase"
                              placeholderLabel="Search"
                              noEntriesFoundLabel="No such phase found"
                            >
                            </ngx-mat-select-search>
                            <mat-option
                              *ngFor="let phase of phasesFiltered | async"
                              [value]="phase"
                            >
                              {{ phase.name }}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>

                      <div class="col-md-4">
                        <mat-form-field>
                          <mat-select
                            id="selectStudyType"
                            formControlName="selectStudyType"
                            placeholder="Study Type"
                            [multiple]="true"
                            #selectStudyType
                          >
                            <ngx-mat-select-search
                              formControlName="filterStudyType"
                              placeholderLabel="Search"
                              noEntriesFoundLabel="No such study-type found"
                            >
                            </ngx-mat-select-search>
                            <mat-option
                              *ngFor="let studyType of studyTypesFiltered | async"
                              [value]="studyType"
                            >
                              {{ studyType.name }}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>

                    </div>

                    <div class="row">

                      <div class="col-md-4">
                        <mat-form-field>
                          <mat-select
                            id="selectStudyCountry"
                            formControlName="selectStudyCountry"
                            placeholder="Country"
                            [multiple]="true"
                            #selectStudyCountry
                          >
                            <ngx-mat-select-search
                              formControlName="filterStudyCountry"
                              placeholderLabel="Search"
                              noEntriesFoundLabel="No such country found"
                            >
                            </ngx-mat-select-search>
                            <mat-option
                              *ngFor="let country of studyCountriesFiltered | async"
                              [value]="country"
                            >
                              {{ country.name }}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>

                      <div class="col-md-4">
                        <mat-form-field>
                          <mat-select
                            id="selectStudyState"
                            formControlName="selectStudyState"
                            placeholder="State/Region"
                            [multiple]="true"
                            #selectStudyState
                          >
                            <ngx-mat-select-search
                              formControlName="filterStudyState"
                              placeholderLabel="Search"
                              noEntriesFoundLabel="No such country found"
                            >
                            </ngx-mat-select-search>
                            <mat-option
                              *ngFor="let state of studyStatesFiltered | async"
                              [value]="state"
                            >
                              {{ state.name }}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>

                      <div class="col-md-4">
                        <mat-form-field>
                          <mat-select
                            id="selectStudyCity"
                            formControlName="selectStudyCity"
                            placeholder="City"
                            [multiple]="true"
                            #selectStudyCity
                          >
                            <ngx-mat-select-search
                              formControlName="filterStudyCity"
                              placeholderLabel="Search"
                              noEntriesFoundLabel="No such country found"
                            >
                            </ngx-mat-select-search>
                            <mat-option
                              *ngFor="let city of studyCitiesFiltered | async"
                              [value]="city"
                            >
                              {{ city.name }}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>

                    </div>

                    <div class="row">

                      <div class="col-md-4">
                          <label for="sliderYearRange">Year-Range</label>
                          <ion-range-slider
                            id="sliderYearRange"
                            #sliderYearRange
                            type="double"
                            [min]="studyStartDateRangeAll.dateBeg.getFullYear()"
                            [max]="studyStartDateRangeAll.dateEnd.getFullYear()"
                            style="width: 300px;"
                            [prettify_enabled]="false"
                            (onFinish)="onSliderYearRangeFinish($event)"
                          >
                          </ion-range-slider>
                      </div>

                      <div class="col-md-4">
                        <div class="row" style="margin-left: 0px">
                          <label for="studySex">Patient Sex</label>
                        </div>
                        <div class="row" style="margin-left: 0px">
                          <mat-radio-group
                            style="padding-top: 20px"
                            id="studySex"
                            formControlName="radioStudySex"
                          >
                            <mat-radio-button value="1">Male</mat-radio-button>
                            <mat-radio-button value="2">Female</mat-radio-button>
                            <mat-radio-button value="3">All</mat-radio-button>
                          </mat-radio-group>
                        </div>
                      </div>

                      <div class="col-md-4">
                          <label for="sliderAgeRange">Age-Range</label>
                          <ion-range-slider
                            id="sliderAgeRange"
                            #sliderAgeRange
                            type="double"
                            [min]="studyEligibilityAgeRangeAll.ageBeg"
                            [max]="studyEligibilityAgeRangeAll.ageEnd"
                            style="width: 300px;"
                            [prettify_enabled]="false"
                            (onFinish)="onSliderAgeRangeFinish($event)"
                          >
                          </ion-range-slider>
                      </div>

                    </div>

                    <div class="row">
                      <div class="col-md-12" style="padding-top: 20px">
                        <button
                          mat-raised-button
                          type="button"
                          class="btn btn-rose mat-raised-button"
                          (click)="onResetFilters()"
                        >
                          <span class="mat-button-wrapper">Reset Filters</span>
                        </button>
                        <button
                          mat-raised-button
                          type="submit"
                          class="btn btn-rose mat-raised-button pull-right"
                        >
                          <span class="mat-button-wrapper">Filter</span>
                        </button>
                      </div>
                    </div>

                  </div>
                </form>

              </div>
              <hr>
              <h5>Studies</h5>
              <div class="row">

                <div class="col-md-12">

                  <mat-table
                    #table
                    [dataSource]="dataSourceStudies"
                    matSort
                    matSortActive="nctId"
                    matSortDirection="asc"
                    matSortDisableClear
                  >

                    <!--Header.-->
                    <mat-header-row
                      *matHeaderRowDef="displayedColumns"
                    ></mat-header-row>
                    <mat-row
                      *matRowDef="let row; columns: displayedColumns;"
                    ></mat-row>

                    <!-- NCT ID column -->
                    <ng-container matColumnDef="nctId">
                      <mat-header-cell
                        *matHeaderCellDef
                        mat-sort-header
                      >
                        NCT ID
                      </mat-header-cell>
                      <mat-cell
                        *matCellDef="let study"
                      >
                        {{study.nctId}}
                      </mat-cell>
                    </ng-container>

                    <!-- Overall status column -->
                    <ng-container matColumnDef="overallStatus">
                      <mat-header-cell
                        *matHeaderCellDef
                        mat-sort-header
                      >
                        Status
                      </mat-header-cell>
                      <mat-cell *matCellDef="let study">
                        {{castOverallStatus(study.overallStatus)}}
                      </mat-cell>
                    </ng-container>

                    <!-- Brief title column -->
                    <ng-container matColumnDef="briefTitle">
                      <mat-header-cell
                        *matHeaderCellDef
                        mat-sort-header
                      >
                        Title
                      </mat-header-cell>
                      <mat-cell *matCellDef="let study">
                        {{study.briefTitle | truncate:77}}
                      </mat-cell>
                    </ng-container>

                    <!-- Conditions column -->
                    <ng-container matColumnDef="conditions">
                      <mat-header-cell
                        *matHeaderCellDef
                      >Conditions
                      </mat-header-cell>
                      <mat-cell *matCellDef="let study">
                        {{ getStudyConditionMeshTerms(study) }}
                      </mat-cell>
                    </ng-container>

                    <!-- Interventions column -->
                    <ng-container matColumnDef="interventions">
                      <mat-header-cell
                        *matHeaderCellDef
                      >Interventions
                      </mat-header-cell>
                      <mat-cell *matCellDef="let study">
                        {{ getStudyInterventionMeshTerms(study) }}
                      </mat-cell>
                    </ng-container>

                    <!-- Locations column -->
                    <ng-container matColumnDef="locations">
                      <mat-header-cell
                        *matHeaderCellDef
                      >Locations
                      </mat-header-cell>
                      <mat-cell *matCellDef="let study">
                        {{ getStudyLocation(study) }}
                      </mat-cell>
                    </ng-container>

                  </mat-table>

                  <mat-paginator
                    [length]="studiesCount"
                    [pageSize]="10"
                    [pageSizeOptions]="studiesPageSizeOptions"
                  ></mat-paginator>

                </div>

              </div>
            </div>

          </div>
        </div>

      </div>

    </div>
  </div>
</div>
